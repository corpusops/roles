---

- name: "Getting backup vars for {{item}}"
  include_jinja_vars:
   name: _cops_burpclientserver
   content: |-
      {%- set hvars = hostvars[item] %}
      {%- set cname, profile = vars|copsfburp_get_cname_and_profile(hvars) %}
      {%- set data = {'cname': cname,
                      'password': vars['cops_burpclient_password_'+item],
                      'profile': profile,
                      'use_profile': hvars.get('burp_client_use_profile',
                                               profile is not none)}
      %}
      {%- set data = data|copsfburp_finish_settings('client', hvars) %}
      {{- data|to_json }}
- name: "Registering backup server conf for {{item}}"
  include_role: {name: corpusops.roles/burp_client_server}
- name: "Reset backup vars for {{item}}"
  include_jinja_vars:
   name: _cops_burpclientserver
   content: "{}"
