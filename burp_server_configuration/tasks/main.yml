---
- tags: [cops_burp_vars]
  block:
  - include_role: {name: corpusops.roles/get_secret_variable}
    vars:
      _cops_get_secret_variable:
        name: cops_burp_ssl_key_password
        path: /etc/secrets
  - include_jinja_vars:
      content: |-
        ---
        {% set prefix = 'cops_burp_' %}
        {% set snamespaced, vars = vars|copsf_registry(prefix) %}
        {% set data = snamespaced[prefix+'vars'] %}
        {{ (snamespaced[prefix+'vars']
            |copsf_registry_to_vars(vars, prefix, global_scope=True)
           )[0]
           | to_json}}
    no_log: "{{not (cops_vars_debug|default(false))}}"
- include_tasks: run.yml
  tags: [cops_burp_server]
