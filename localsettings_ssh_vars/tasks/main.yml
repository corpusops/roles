---
- include_jinja_vars:
    content: |-
      ---
      {% set prefix = 'corpusops_localsettings_ssh_' %}
      {% set snamespaced, vars = vars|copsf_registry(prefix) %}
      {% set namespaced = snamespaced[prefix+'vars'] %}
      {%- set hostssettings = namespaced.setdefault(
            'hostssettings', {}) %}
      {%- for shost, val in namespaced.settings.items() %}
      {%- set host = shost.split('___', 1)[0] %}
      {%- set knob = '___'.join(shost.split('___', 1)[1:]) %}
      {%- set hostsettings = hostssettings.setdefault(host, {}) %}
      {%- set _ = hostsettings.update({knob: val}) %}
      {%- endfor %}
      {{ (snamespaced[prefix+'vars']
           | copsf_registry_to_vars(
               vars, prefix, global_scope=True)
             )[0] | to_json}}
  tags: [corpusops_vars, corpusops_localsettings_ssh_vars]
  no_log: "{{not (cops_vars_debug|default(false))}}"
