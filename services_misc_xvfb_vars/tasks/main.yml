---
- include_jinja_vars:
    content: |-
      ---
      {% set prefix = 'corpusops_services_misc_xvfb_' %}
      {% set snamespaced, vars = vars|copsf_registry(prefix) %}
      {% set namespaced = snamespaced[prefix+'vars'] %}
      {% if ((ansible_lsb.id.lower() in ['ubuntu']) and
             (ansible_lsb.release < '15.04')) %}
      {%  set _ = namespaced['files'].extend(
           namespaced['files_upstart']) %}
      {%  set _ = namespaced['configs'].extend(
           namespaced['configs_upstart']) %}
      {%  for p in ['python-xvfbwrapper', 'python3-xvfbwrapper'] %}
      {%    set _ = namespaced['packages'].pop(namespaced['packages'].index(p)) %}
      {%  endfor %}
      {% endif %}
      {{ (snamespaced[prefix+'vars']
           | copsf_registry_to_vars(
               vars, prefix, global_scope=True)
             )[0] | to_json}}     
  tags: [corpusops_vars, corpusops_services_misc_xvfb_vars]
  no_log: "{{not (cops_vars_debug|default(false))}}"
