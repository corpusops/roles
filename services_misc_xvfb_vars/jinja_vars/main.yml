---
{% set prefix = 'corpusops_services_misc_xvfb_' %}
{% set flavors = ['ubuntu', 'debian', 'redhat', 'default'] %}
{% set knobs = ['files', 'filescopy',
                'services', 'configs', 'packages'] %}
{% set computed_defaults = [] %}
{% set lowered = [] %}
{% set sub_namespaced = {'settings': {}} %}
{% set namespaced = {'settings': {}} %}
{% set subos_append = {} %}
{% set namespaced, vars = vars
   | copsf_registry(
        prefix,
        knobs=knobs, subos_append=subos_append,
        lowered=lowered, computed_defaults=computed_defaults,
        flavors=flavors, namespaced=namespaced, sub_namespaced=sub_namespaced)
%}
{% if ((ansible_lsb.id.lower() in ['ubuntu']) and
       (ansible_lsb.release < '15.04')) %}
{%  set _ = namespaced['files'].extend(
     namespaced['files_upstart']) %}
{%  set _ = namespaced['configs'].extend(
     namespaced['configs_upstart']) %}
{%  for p in ['python-xvfbwrapper', 'python3-xvfbwrapper'] %}
{%    set _ = namespaced['packages'].pop(namespaced['packages'].index(p)) %}
{%  endfor %}
{% endif %}
{{ (namespaced | copsf_registry_to_vars(vars, prefix))[0] | to_json }} 
