---
- tags: [cops_burpclientserver_vars]
  block:
  - include_jinja_vars:
      content: |-
        ---
        {%- set prefix = 'cops_burpclientserver_' %}
        {%- set client = inventory_hostname %}
        {%- set hvars = hostvars[client] %}
        {%- set snamespaced, vars = vars|copsf_registry(prefix) %}
        {%- set data = snamespaced[prefix+'vars'] %}
        {%- set r = [] %}
        {%- if not data.use_profile %}
        {%- elif data.profile %}
        {%-   set _ = r.append(data.get('profiles_'+data.profile)) %}
        {%- endif %}
        {%- set _ = r.extend(data.custom_lines) %}
        {%- set _ = data.update({'custom_lines_computed': r})%}
        {{- (snamespaced[prefix+'vars']
            |copsf_registry_to_vars(vars, prefix, global_scope=True)
           )[0] | to_yaml}}
    no_log: "{{not (cops_vars_debug|default(false))}}"
- include_tasks: run.yml
  tags: [cops_burpclientserver_server]
  no_log: "{{not (cops_vars_debug|default(false))}}"

