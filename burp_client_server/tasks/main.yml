---
- tags: [cops_burpclientserver_vars]
  name: registry setter
  vars: {cops_vars_registry_target: cops_burpclientserver}
  include_jinja_vars:
    content: |-
        {%- set cops_vars_registry_prefix = cops_vars_registry_target+"_" %}
        {%- set registry = lookup('cops_registry', cops_vars_registry_prefix) %}
        {%- set namespaced = registry[cops_vars_registry_prefix+'vars'] %}
        {%- set client = inventory_hostname %}
        {%- set hvars = hostvars[client] %}
        {%- set r = [] %}
        {%- if not namespaced.use_profile %}
        {%- elif namespaced.profile %}
        {%-   if 'profiles_'+namespaced.profile in namespaced %}
        {%-     set _ = r.append(namespaced['profiles_'+namespaced.profile]) %}
        {%-   else %}
        {%-     set _ = r.append('# using client side profile') %}
        {%-     set _ = r.append(namespaced.profile) %}
        {%-   endif %}
        {%- endif %}
        {%- set _ = r.extend(namespaced.custom_lines) %}
        {%- set _ = namespaced.update({'custom_lines_computed': r})%}
        {%- for name, val in namespaced.items() %}
        {%-    set _ = registry.update({cops_vars_registry_prefix+name: val}) %}
        {%- endfor %}
        {{- registry|to_json }}
  no_log: "{{not (cops_vars_debug|default(false))}}"
- pause: {}
  when: cops_burp_debug|default(false)
- include_tasks: run.yml
  tags: [cops_burpclientserver_server]
  no_log: "{{not (cops_vars_debug|default(false))}}"

