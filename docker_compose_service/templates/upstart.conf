# {{ansible_managed}}

#{% set v = docker_compose_service_vars %}
#{% set d = v.project %}
#{% set w = v.working_directory %}
description "{{d}} DockerCompose service"
author "corpusops"
start on filesystem and started docker
stop on runlevel [!2345]
# Automatically restart process if crashed (limit 3 times in 4 minutes)
{% if "{0}".format(v.restart).lower() not in ["no", "false"] %}
respawn
{% endif %}
kill signal SIGINT

script
set -x
cd "{{w}}"
/usr/bin/env docker-compose -p "{{d}}" pull &&\
/usr/bin/env docker-compose -p "{{d}}" up
end script

pre-start script
cd "{{w}}"
/usr/bin/env docker-compose -p "{{d}}" config || exit 1
end script

pre-stop script
cd "{{w}}"
/usr/bin/env docker-compose -p "{{d}}" config || exit 1
end script

post-stop script
set -x
cd "{{w}}"
/usr/bin/env docker-compose -p "{{d}}" stop || /bin/true
/usr/bin/env docker-compose -p "{{d}}" down || /bin/true
end script
# vim: set ft=upstart :
