---
- tags: [certbot_configs]
  block:
  - set_fact:
      cacheable: false
      cops_configs_files: "{{corpusops_localsettings_certbot_vars.files}}"
      cops_configs_copys: "{{corpusops_localsettings_certbot_vars.filescopy}}"
      cops_configs_templates: "{{corpusops_localsettings_certbot_vars.configs}}"
  - include_role: {name: corpusops.roles/configs, public: false}
  - set_fact:
      cacheable: false
      corpusops_localsettings_certbot_filest: "{{cops_configs_files_results}}"
      corpusops_localsettings_certbot_filesct: "{{cops_configs_copys_results}}"
      corpusops_localsettings_certbot_configst: "{{cops_configs_templates_results}}"
- set_fact:
    cacheable: false
    corpusops_localsettings_certbot_configs_changed: "{{(
      (corpusops_localsettings_certbot_filest          |default({})) is changed or
      (corpusops_localsettings_certbot_filesct         |default({})) is changed or
      (corpusops_localsettings_certbot_configst        |default({})) is changed
      )}}"
- file:
    state: absent
    path: /etc/cron.d/cops_le_renew
  when: "not corpusops_localsettings_certbot_vars.has_cron"
- copy:
    content: "{{corpusops_localsettings_certbot_vars.cron}}"
    dest: /etc/cron.d/cops_le_renew
    mode: "0640"
    force: true
  when: "corpusops_localsettings_certbot_vars.has_cron"
